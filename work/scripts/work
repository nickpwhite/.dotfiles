#!/usr/bin/env bash
set -euo pipefail

if [[ $# -ne 1 ]]; then
  echo "Usage: $(basename "$0") <branch_name>" >&2
  exit 1
fi

branch_name=$1
directory_name="../$branch_name"

if [[ ! -d "$directory_name" ]]; then
  git worktree add -b "$branch_name" "$directory_name"
  if [[ -f apps/web/.env.local ]]; then
    cp apps/web/.env.local "$directory_name/apps/web/"
  fi
fi
pushd "$directory_name" > /dev/null
npm install
popd > /dev/null
tmux new-window -c "$directory_name" -n "$branch_name" nvim
tmux split-window -h -l 55 -c "$directory_name" codex --full-auto --search
